<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人员信息查询系统</title>
    <style>
        /* 基础样式设置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            background-color: #f5f5f5;
            padding: 20px;
        }
        /* 密码登录框样式 */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: block;
        }
        .login-container h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #333;
        }
        .login-container input {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .login-container button {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        .login-container button:hover {
            background-color: #45a049;
        }
        .error-tip {
            color: #ff4444;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        /* 数据展示区域样式 */
        .data-container {
            max-width: 800px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: none;
        }
        .data-container h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .data-table th {
            background-color: #f9f9f9;
            color: #666;
            font-weight: 600;
        }
        .phone-link {
            color: #2196F3;
            text-decoration: none;
        }
        .phone-link:hover {
            text-decoration: underline;
        }
        /* 加载提示样式 */
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- 密码登录区域 -->
    <div class="login-container" id="loginSection">
        <h2>请输入密码进入系统</h2>
        <input type="password" id="passwordInput" placeholder="请输入密码">
        <button id="loginBtn">登录</button>
        <div class="error-tip" id="errorTip">密码错误，请重新输入！</div>
        <div class="loading" id="loginLoading" style="display: none;">验证中...</div>
    </div>

    <!-- 数据展示区域 -->
    <div class="data-container" id="dataSection">
        <h2>人员信息列表</h2>
        <div class="loading" id="dataLoading">加载数据中...</div>
        <table class="data-table" style="display: none;">
            <thead>
                <tr>
                    <th>部门</th>
                    <th>姓名</th>
                    <th>手机号码</th>
                </tr>
            </thead>
            <tbody id="dataTableBody">
                <!-- 数据将通过JS动态插入 -->
            </tbody>
        </table>
    </div>

    <script>
        // 全局变量存储密码和用户数据
        let validPassword = '';
        let userData = [];

        // 获取DOM元素
        const loginSection = document.getElementById('loginSection');
        const dataSection = document.getElementById('dataSection');
        const passwordInput = document.getElementById('passwordInput');
        const loginBtn = document.getElementById('loginBtn');
        const errorTip = document.getElementById('errorTip');
        const dataTableBody = document.getElementById('dataTableBody');
        const loginLoading = document.getElementById('loginLoading');
        const dataLoading = document.getElementById('dataLoading');
        const dataTable = document.querySelector('.data-table');

        // 初始化：加载密码文件
        fetch('code.txt')
            .then(response => {
                if (!response.ok) throw new Error('密码文件加载失败');
                return response.text();
            })
            .then(text => {
                // 清除可能的空白字符
                validPassword = text.trim();
            })
            .catch(error => {
                alert('系统初始化失败: ' + error.message);
            });

        // 登录按钮点击事件
        loginBtn.addEventListener('click', () => {
            const inputPassword = passwordInput.value.trim();
            
            if (!inputPassword) {
                showError('请输入密码');
                return;
            }
            
            if (!validPassword) {
                showError('密码验证文件未加载完成，请稍后重试');
                return;
            }
            
            loginLoading.style.display = 'block';
            loginBtn.disabled = true;
            
            // 简单的延迟模拟验证过程
            setTimeout(() => {
                if (inputPassword === validPassword) {
                    loginSection.style.display = 'none';
                    dataSection.style.display = 'block';
                    loadUserData(); // 密码正确后加载数据
                } else {
                    showError('密码错误，请重新输入！');
                }
                loginLoading.style.display = 'none';
                loginBtn.disabled = false;
            }, 500);
        });

        // 监听回车键登录
        passwordInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                loginBtn.click();
            }
        });

        // 加载用户数据
        function loadUserData() {
            fetch('data.txt')
                .then(response => {
                    if (!response.ok) throw new Error('数据文件加载失败');
                    return response.text();
                })
                .then(text => {
                    // 解析数据
                    userData = parseUserData(text);
                    renderUserData();
                    dataLoading.style.display = 'none';
                    dataTable.style.display = 'table';
                })
                .catch(error => {
                    dataLoading.textContent = '数据加载失败: ' + error.message;
                });
        }

        // 解析用户数据
        function parseUserData(text) {
            const lines = text.split('\n');
            const result = [];
            
            lines.forEach(line => {
                // 清除空白行和前后空格
                const trimmedLine = line.trim();
                if (!trimmedLine) return;
                
                // 按格式分割
                const parts = trimmedLine.split('-');
                if (parts.length === 3) {
                    result.push({
                        department: parts[0].trim(),
                        name: parts[1].trim(),
                        phone: parts[2].trim()
                    });
                }
            });
            
            return result;
        }

        // 渲染用户数据
        function renderUserData() {
            // 清空表格内容
            dataTableBody.innerHTML = '';
            
            if (userData.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="3" style="text-align: center;">没有找到数据</td>';
                dataTableBody.appendChild(tr);
                return;
            }
            
            // 遍历数据数组，生成表格行
            userData.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.department}</td>
                    <td>${user.name}</td>
                    <td><a href="tel:${user.phone}" class="phone-link">${user.phone}</a></td>
                `;
                dataTableBody.appendChild(tr);
            });
        }

        // 显示错误提示
        function showError(message) {
            errorTip.textContent = message;
            errorTip.style.display = 'block';
            passwordInput.value = '';
            
            // 3秒后隐藏错误提示
            setTimeout(() => {
                errorTip.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>